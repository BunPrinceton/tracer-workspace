<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Princeton Tracer Master Guide</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #1a252f;
            --deprecated: #95a5a6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f6fa;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }

        /* Navigation */
        nav {
            background: var(--dark);
            padding: 0;
        }

        nav ul {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            list-style: none;
            max-width: 1400px;
            margin: 0 auto;
        }

        nav li {
            position: relative;
        }

        nav a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            transition: background 0.3s;
            font-weight: 500;
        }

        nav a:hover {
            background: var(--secondary);
        }

        nav .dropdown-content {
            display: none;
            position: absolute;
            background: var(--dark);
            min-width: 220px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1001;
        }

        nav li:hover .dropdown-content {
            display: block;
        }

        nav .dropdown-content a {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        /* Main Content */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Sections */
        section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        section h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--secondary);
            padding-bottom: 10px;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        section h3 {
            color: var(--secondary);
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        section h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        /* Status Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 10px;
        }

        .badge-current { background: var(--success); color: white; }
        .badge-reference { background: var(--warning); color: white; }
        .badge-deprecated { background: var(--deprecated); color: white; }
        .badge-training { background: var(--secondary); color: white; }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: var(--light);
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid var(--secondary);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .card.deprecated {
            border-left-color: var(--deprecated);
            opacity: 0.85;
        }

        .card h4 {
            margin: 0 0 10px 0;
            color: var(--primary);
        }

        .card p {
            font-size: 0.95em;
            color: #666;
            margin-bottom: 10px;
        }

        .card .meta {
            font-size: 0.85em;
            color: #888;
        }

        /* Tool Tags */
        .tool-tag {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-right: 5px;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .action-btn {
            display: inline-flex;
            align-items: center;
            padding: 12px 20px;
            background: var(--secondary);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: background 0.3s, transform 0.2s;
        }

        .action-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .action-btn.secondary {
            background: var(--light);
            color: var(--primary);
        }

        .action-btn.secondary:hover {
            background: #dfe6e9;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--secondary);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 25px;
            padding: 15px 20px;
            background: var(--light);
            border-radius: 8px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: var(--secondary);
            border-radius: 50%;
            border: 3px solid white;
        }

        .timeline-item.deprecated::before {
            background: var(--deprecated);
        }

        .timeline-item h4 {
            margin: 0 0 8px 0;
        }

        .timeline-item .date {
            font-size: 0.85em;
            color: #888;
        }

        /* Checklist */
        .checklist {
            list-style: none;
        }

        .checklist li {
            padding: 10px 15px;
            margin: 8px 0;
            background: var(--light);
            border-radius: 6px;
            border-left: 4px solid var(--success);
        }

        .checklist li::before {
            content: '\2713';
            color: var(--success);
            font-weight: bold;
            margin-right: 10px;
        }

        /* Code blocks */
        pre, code {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #2d3436;
            color: #dfe6e9;
            border-radius: 4px;
        }

        code {
            padding: 2px 6px;
            font-size: 0.9em;
        }

        pre {
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
        }

        pre code {
            padding: 0;
            background: none;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: var(--primary);
            color: white;
        }

        tr:hover {
            background: var(--light);
        }

        /* Keyboard shortcuts */
        kbd {
            background: #eee;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 2px 6px;
            font-family: monospace;
            font-size: 0.9em;
            box-shadow: 0 2px 0 #ccc;
        }

        /* Collapsible sections */
        details {
            background: var(--light);
            border-radius: 8px;
            margin: 15px 0;
        }

        summary {
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary);
        }

        summary:hover {
            background: rgba(0,0,0,0.05);
        }

        details[open] summary {
            border-bottom: 1px solid #ddd;
        }

        details .content {
            padding: 20px;
        }

        /* Search */
        .search-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        #search {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
        }

        #search:focus {
            border-color: var(--secondary);
        }

        /* Print styles */
        @media print {
            header, nav { position: static; }
            .action-btn { display: none; }
            section { break-inside: avoid; }
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            header h1 { font-size: 1.8em; }
            nav ul { flex-direction: column; }
            nav a { padding: 12px 15px; }
            .card-grid { grid-template-columns: 1fr; }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Back to top */
        #back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--secondary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 1.5em;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
        }

        #back-to-top.visible {
            opacity: 1;
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .alert-info {
            background: #e3f2fd;
            border-left: 4px solid var(--secondary);
        }

        .alert-warning {
            background: #fff3e0;
            border-left: 4px solid var(--warning);
        }

        .alert-success {
            background: #e8f5e9;
            border-left: 4px solid var(--success);
        }
    </style>
</head>
<body>

<header>
    <h1>Princeton Tracer Master Guide</h1>
    <p class="subtitle">Comprehensive Documentation for Connectomics Annotation</p>
    <p style="margin-top: 10px; opacity: 0.7; font-size: 0.9em;">Last Updated: December 2025</p>
</header>

<nav>
    <ul>
        <li><a href="#overview">Overview</a></li>
        <li>
            <a href="#current-tools">Current Tools</a>
            <div class="dropdown-content">
                <a href="#webknossos">WebKnossos</a>
                <a href="#neuroglancer">Neuroglancer</a>
                <a href="#tracer-tools">tracer_tools</a>
                <a href="#tampermonkey">Tampermonkey Scripts</a>
            </div>
        </li>
        <li>
            <a href="#ground-truth">Ground Truth</a>
            <div class="dropdown-content">
                <a href="#gt-sop">Task Handling SOP</a>
                <a href="#gt-protocols">Protocol Guidelines</a>
                <a href="#gt-verification">Verification</a>
                <a href="#gt-checklist">Checklist</a>
            </div>
        </li>
        <li>
            <a href="#training">Training</a>
            <div class="dropdown-content">
                <a href="#synapses">Synapse Annotation</a>
                <a href="#vesicles">Vesicle Tracing</a>
                <a href="#semantic">Semantic Segmentation</a>
            </div>
        </li>
        <li><a href="#setup">Setup Guides</a></li>
        <li><a href="#history">History</a></li>
        <li><a href="#reference">Reference</a></li>
    </ul>
</nav>

<main>

<!-- Search -->
<div class="search-container">
    <input type="text" id="search" placeholder="Search documentation... (e.g., 'synapse', 'myelin', 'WebKnossos')">
</div>

<!-- Overview Section -->
<section id="overview">
    <h2>Overview</h2>

    <p>Welcome to the Princeton Tracer documentation hub. This guide consolidates all training materials, protocols, and tool references for neuroscience connectomics annotation work.</p>

    <div class="quick-actions">
        <a href="#gt-sop" class="action-btn">Start a GT Task</a>
        <a href="#gt-checklist" class="action-btn">GT Checklist</a>
        <a href="#webknossos" class="action-btn secondary">WebKnossos Guide</a>
        <a href="#tracer-tools" class="action-btn secondary">tracer_tools Docs</a>
    </div>

    <h3>Current Ecosystem</h3>
    <div class="card-grid">
        <div class="card">
            <h4>WebKnossos <span class="badge badge-current">Current</span></h4>
            <p>Primary annotation platform for volume segmentation and proofreading.</p>
            <div class="meta"><span class="tool-tag">Annotation</span> <span class="tool-tag">3D Viewing</span></div>
        </div>
        <div class="card">
            <h4>Neuroglancer <span class="badge badge-current">Current</span></h4>
            <p>Web-based volumetric data viewer for synapse annotation and verification.</p>
            <div class="meta"><span class="tool-tag">Viewing</span> <span class="tool-tag">Synapses</span></div>
        </div>
        <div class="card">
            <h4>tracer_tools <span class="badge badge-current">Current</span></h4>
            <p>Python library for CAVE/Neuroglancer API access and batch processing.</p>
            <div class="meta"><span class="tool-tag">Python</span> <span class="tool-tag">CAVE</span></div>
        </div>
        <div class="card">
            <h4>CAVE <span class="badge badge-current">Current</span></h4>
            <p>Connectome Annotation Versioning Engine - backend for data queries.</p>
            <div class="meta"><span class="tool-tag">API</span> <span class="tool-tag">Database</span></div>
        </div>
    </div>

    <h3>Supported Datasets</h3>
    <table>
        <tr>
            <th>Dataset</th>
            <th>Organism</th>
            <th>Datastack</th>
            <th>Status</th>
        </tr>
        <tr>
            <td>FlyWire FAFB</td>
            <td>Drosophila</td>
            <td><code>flywire_fafb_production</code></td>
            <td><span class="badge badge-current">Active</span></td>
        </tr>
        <tr>
            <td>BANC</td>
            <td>Drosophila (Brain + Nerve Cord)</td>
            <td><code>brain_and_nerve_cord</code></td>
            <td><span class="badge badge-current">Active</span></td>
        </tr>
    </table>
</section>

<!-- Current Tools Section -->
<section id="current-tools">
    <h2>Current Tools</h2>

    <div id="webknossos">
        <h3>WebKnossos <span class="badge badge-current">Current</span></h3>
        <p>WebKnossos is the primary annotation platform for volume segmentation tasks. It supports skeleton and volume annotations, 3D mesh visualization, and collaborative workflows.</p>

        <h4>Key Features</h4>
        <ul class="checklist">
            <li>Volume annotation with brush tools</li>
            <li>3D mesh generation (right-click on segment)</li>
            <li>Interpolation for quick annotation across slices</li>
            <li>SAM2 AI-assisted segmentation (experimental)</li>
        </ul>

        <h4>Essential Keyboard Shortcuts</h4>
        <table>
            <tr><th>Key</th><th>Action</th></tr>
            <tr><td><kbd>.</kbd></td><td>Toggle between all views and current view</td></tr>
            <tr><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>O</kbd></td><td>Toggle volume opacity (Tampermonkey)</td></tr>
            <tr><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>E</kbd></td><td>Toggle EM layer opacity (Tampermonkey)</td></tr>
            <tr><td>Right-click segment</td><td>Generate 3D mesh / Quick rename</td></tr>
        </table>

        <h4>Access URLs</h4>
        <ul>
            <li><a href="https://webknossos.org/" target="_blank">webknossos.org</a></li>
            <li><a href="http://wk.zetta.ai/" target="_blank">wk.zetta.ai</a></li>
        </ul>
    </div>

    <div id="neuroglancer">
        <h3>Neuroglancer <span class="badge badge-current">Current</span></h3>
        <p>Web-based viewer for volumetric data, primarily used for synapse annotation and verification.</p>

        <h4>Synapse Annotation Controls</h4>
        <table>
            <tr><th>Action</th><th>Control</th><th>Description</th></tr>
            <tr><td>Mark Axon</td><td>Left Click</td><td>Place red point on presynaptic side</td></tr>
            <tr><td>Mark Dendrite</td><td>Right Click</td><td>Place blue point on postsynaptic side</td></tr>
            <tr><td>Zoom</td><td><kbd>Ctrl</kbd>+Scroll</td><td>Zoom in/out</td></tr>
            <tr><td>3D Rotate</td><td><kbd>Ctrl</kbd>+Left Click</td><td>Rotate 3D view</td></tr>
        </table>

        <h4>Synapse Verification Workflow</h4>
        <ol>
            <li>Locate synapse in volume</li>
            <li>Identify axon bouton (presynaptic)</li>
            <li>Identify dendrite spine/trunk (postsynaptic)</li>
            <li>Place red point on axon, blue point on dendrite</li>
            <li>Verify using 3D mesh and 2D EM stack</li>
            <li>Save and proceed to next segment</li>
        </ol>
    </div>

    <div id="tracer-tools">
        <h3>tracer_tools Library <span class="badge badge-current">Current</span></h3>
        <p>Python library for programmatic access to CAVE and Neuroglancer.</p>

        <h4>Installation</h4>
        <pre><code>cd tracer_tools
pip install -e .
pip install caveclient cloudvolume pandas nglui</code></pre>

        <h4>Core Functions</h4>
        <table>
            <tr><th>Function</th><th>Purpose</th></tr>
            <tr><td><code>coords_to_root(coords, datastack)</code></td><td>Get root ID from coordinates</td></tr>
            <tr><td><code>root_to_coords(root_ids, datastack)</code></td><td>Get coordinates for root IDs</td></tr>
            <tr><td><code>update_root_ids(ids, datastack)</code></td><td>Update outdated root IDs</td></tr>
            <tr><td><code>build_ng_link(root_ids, datastack)</code></td><td>Generate Neuroglancer link</td></tr>
            <tr><td><code>get_synapse_counts(root_ids, datastack)</code></td><td>Get pre/post synapse counts</td></tr>
        </table>

        <h4>CLI Examples</h4>
        <pre><code># Get coordinates for root IDs
python scripts/get_coords_cli.py --datastack brain_and_nerve_cord --ids 720575941471915328

# Update outdated IDs
python scripts/update_ids_cli.py --datastack brain_and_nerve_cord --with-coords

# Process Google Sheet
python scripts/sheets_coords_oauth.py --sheet "SHEET_ID" --update-ids</code></pre>

        <div class="alert alert-warning">
            <strong>Critical:</strong> Many functions have hardcoded datastack assumptions. <code>build_ng_link</code> only works with FlyWire and BANC.
        </div>
    </div>

    <div id="tampermonkey">
        <h3>Tampermonkey Scripts <span class="badge badge-current">Current</span></h3>
        <p>Browser userscripts to enhance WebKnossos functionality.</p>

        <h4>Available Scripts</h4>
        <table>
            <tr><th>Script</th><th>Shortcut</th><th>Function</th></tr>
            <tr><td>Volume Opacity Toggle</td><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>O</kbd></td><td>Toggle volume layer opacity</td></tr>
            <tr><td>Pattern Opacity Toggle</td><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd></td><td>Toggle pattern opacity</td></tr>
            <tr><td>EM Opacity Toggle</td><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>E</kbd></td><td>Toggle EM layer opacity</td></tr>
            <tr><td>Quick Rename</td><td>Right-click</td><td>Rename segments from context menu</td></tr>
            <tr><td>Keyboard Shortcuts</td><td>Various</td><td>Additional keyboard shortcuts for renaming</td></tr>
        </table>

        <h4>Installation</h4>
        <ol>
            <li>Install Tampermonkey browser extension</li>
            <li>Open Tampermonkey dashboard</li>
            <li>Click "+" tab or "Import from file"</li>
            <li>Import the <code>.user.js</code> files from <code>tampermonkey-scripts/</code></li>
            <li>Reload WebKnossos</li>
        </ol>

        <p><strong>Debug:</strong> All scripts log to console with <code>[WK ...]</code> prefix. Open DevTools (F12) to see logs.</p>
    </div>
</section>

<!-- Ground Truth Section -->
<section id="ground-truth">
    <h2>Ground Truth Protocols</h2>

    <div id="gt-sop">
        <h3>Task Handling SOP <span class="badge badge-current">Current</span></h3>
        <p><em>Standard Operating Procedure for Ground Truth Task Management</em></p>
        <p class="meta">Owner: Benjamin Silverman | Created: Nov 5, 2025</p>

        <h4>Roles</h4>
        <ul>
            <li><strong>Task Owner:</strong> Responsible for overall task coordination</li>
            <li><strong>Tester(s):</strong> First to work on new task types, provide feedback</li>
            <li><strong>Team Members:</strong> Execute tasks following established protocols</li>
        </ul>

        <h4>Workflow Phases</h4>
        <div class="timeline">
            <div class="timeline-item">
                <h4>1. Initial Task Introduction</h4>
                <p>Task Owner announces new task via Slack/Zoom. Includes task description, expected outcomes, and any special requirements.</p>
            </div>
            <div class="timeline-item">
                <h4>2. Tester Assignment</h4>
                <p>Select 1-2 testers to work on task first. Testers identify issues before full team deployment.</p>
            </div>
            <div class="timeline-item">
                <h4>3. Initial Testing Phase</h4>
                <p>Testers complete subset of task, document questions and edge cases.</p>
            </div>
            <div class="timeline-item">
                <h4>4. Early Submission & Feedback</h4>
                <p>Testers submit work for review. Task Owner provides feedback, clarifies protocols.</p>
            </div>
            <div class="timeline-item">
                <h4>5. Full Team Task Delivery</h4>
                <p>Zoom meeting to present refined task to entire team. Address questions, share best practices.</p>
            </div>
            <div class="timeline-item">
                <h4>6. Task Execution</h4>
                <p>Team executes task. Ongoing communication via Slack for questions.</p>
            </div>
        </div>

        <h4>Key Principles</h4>
        <ul class="checklist">
            <li><strong>Variability Expected:</strong> First attempts may need adjustment</li>
            <li><strong>Test Before Scale:</strong> Always test with subset before full deployment</li>
            <li><strong>Document Changes:</strong> All protocol changes must be recorded</li>
            <li><strong>Inclusive Communication:</strong> All team members should be informed of changes</li>
        </ul>
    </div>

    <div id="gt-protocols">
        <h3>Protocol Guidelines <span class="badge badge-current">Current</span></h3>
        <p class="meta">Source: Tommy Macrina's Directives (August - September 2025) via #putracers Slack</p>

        <details open>
            <summary>Mitochondria Segmentation</summary>
            <div class="content">
                <h4>1.1 Individual Segmentation Required</h4>
                <p>Each mitochondrion must be assigned a <strong>separate segment ID and color</strong>. Do not paint all mitochondria with the same segment.</p>

                <h4>1.2 Oversegmentation Directive</h4>
                <p>The original task description stating "do NOT oversegment mitochondria" was <strong>incorrect and should be disregarded</strong>. Mitochondria must be oversegmented individually.</p>

                <h4>1.3 Membrane Handling</h4>
                <p>Do NOT paint mitochondrial membranes. Leave a <strong>visible border/gap</strong> around each mitochondrion to represent the membrane boundary.</p>
            </div>
        </details>

        <details>
            <summary>Myelin Segmentation</summary>
            <div class="content">
                <h4>2.1 Inner Boundary (Cell Interface)</h4>
                <p><strong>No padding</strong> between myelin and the cell it ensheathes. The myelin segment should directly contact the inner cell.</p>

                <h4>2.2 Myelin-to-Myelin Contact</h4>
                <p><strong>No padding</strong> between adjacent myelin segments. Myelin segments may touch each other.</p>

                <h4>2.3 Outer Boundary (Adjacent Cells)</h4>
                <p>Myelin should <strong>approach but not touch</strong> the membranes of neighboring cells. Maintain a small gap between myelin exterior and other cell membranes.</p>

                <div class="alert alert-info">
                    <strong>Summary:</strong> Inner = touch cell, Middle = touch other myelin, Outer = gap from neighbors
                </div>
            </div>
        </details>

        <details>
            <summary>Upsampled Image Handling</summary>
            <div class="content">
                <h4>3.1 Two-Pass Labeling Approach</h4>
                <p>Recommended workflow:</p>
                <ol>
                    <li><strong>First pass:</strong> Paint annotations on the original image (thicker sections)</li>
                    <li><strong>Second pass:</strong> Copy labels onto the upsampled image and connect objects naturally</li>
                </ol>

                <h4>3.2 Multi-Resolution Viewing</h4>
                <p>Working exclusively from upsampled images can be misleading. <strong>Always cross-reference with original image data.</strong></p>

                <h4>3.3 Handling Artifacts ("Hallucinations")</h4>
                <p>Artificial structures in upsampled data should be <strong>ignored</strong>. Focus on anatomically sensible structures. From spot checks, tracers have done well ignoring hallucinations.</p>
            </div>
        </details>

        <details>
            <summary>Ambiguous Cases & Edge Cases</summary>
            <div class="content">
                <h4>4.1 Uncertain Organelles</h4>
                <p>When uncertain whether an object is a mitochondrion (vs. peroxisome, lysosome, etc.), <strong>segment it as a mitochondrion</strong>. Objects can be removed during review if needed.</p>

                <h4>4.2 EM Damage Regions</h4>
                <p>For EM damage handling:</p>
                <ul>
                    <li>If damage is <strong>inside the segment</strong>, label it as the segment it's in</li>
                    <li>If damage is <strong>on the border</strong>, follow team consensus for handling</li>
                </ul>
            </div>
        </details>

        <details>
            <summary>WebKnossos Tools & Techniques</summary>
            <div class="content">
                <h4>6.1 Interpolation Tool</h4>
                <p>The volume interpolation feature is particularly useful for objects perpendicular to the sectioning plane in higher z-resolution data. May require manual cleanup. Works best with:</p>
                <ul>
                    <li>Large, simple round segments with minimal movement between slices</li>
                    <li>2 slice gaps (5-6 slice gaps may cause confusion with size changes)</li>
                </ul>

                <h4>6.2 3D Mesh Visualization</h4>
                <ul>
                    <li><strong>Right-click</strong> on any segment to generate a 3D mesh</li>
                    <li>Press <kbd>.</kbd> (period) to toggle between all views and view under cursor</li>
                    <li>Useful for quality control and identifying errors</li>
                </ul>

                <h4>6.3 SAM2 AI Segmentation (Experimental)</h4>
                <p>New AI-assisted segmentation available on experimental server (ranl.zetta.ai:9000):</p>
                <ul>
                    <li>Most effective for larger, convex cross-sections without many intercellular objects</li>
                    <li>Adjust confidence threshold and erosion parameters for optimal results</li>
                    <li>Can use existing segment annotations as hints for consistency</li>
                </ul>
            </div>
        </details>
    </div>

    <div id="gt-verification">
        <h3>Verification Procedures <span class="badge badge-current">Current</span></h3>

        <h4>Mandatory Peer Review</h4>
        <p>Before marking tasks as finished, at least one other team member must inspect your work. Prioritize sharing areas where you struggled.</p>

        <h4>Sharing Annotations for Review</h4>
        <ol>
            <li>Navigate to Tasks in WebKnossos</li>
            <li>Search for tasks under the relevant project</li>
            <li>Click the plus symbol (+) for the task</li>
            <li>Select "Actions" button (right side)</li>
            <li>Choose "View"</li>
        </ol>

        <h4>Verification Checklist</h4>
        <ul class="checklist">
            <li>Cell segmentation complete (use VAST/Omni inspection)</li>
            <li>Borders checked for accuracy</li>
            <li>No mergers or splitters</li>
            <li>No missing segments</li>
            <li>Synapse labeling verified</li>
            <li>Mitochondria properly labeled</li>
            <li>Semantic segmentation complete</li>
            <li>Vesicle clouds labeled</li>
            <li>Myelin properly segmented</li>
        </ul>
    </div>

    <div id="gt-checklist">
        <h3>Ground Truth Checklist <span class="badge badge-current">Current</span></h3>

        <div class="alert alert-info">
            <strong>Note:</strong> Rules may vary between projects. Always consult project leader when uncertain.
        </div>

        <h4>Extracellular Space & Boundaries</h4>
        <ul class="checklist">
            <li><strong>Use 1 segment for all extracellular space</strong></li>
            <li><strong>Use 1 segment for objects that connect 20 slices outside the boundaries</strong></li>
            <li><strong>Parallel plane boundaries</strong> should be given the area they need - careful not to over-color them and allow space for the boundary</li>
            <li>When segmenting <strong>thin lines of glial or extracellular space</strong>, it's ok to bend the parallel boundary rule and segment darker than normal areas (so long as you believe they are part of those objects)</li>
        </ul>

        <h4>Invaginations & Internal Objects</h4>
        <ul class="checklist">
            <li>Be cognizant of <strong>invaginations</strong> - use a keen eye when investigating internal objects such as organelles/ER</li>
            <li>Keep an eye on <strong>the borders of your volume</strong> and always check for <strong>small segments</strong> that just barely pass by - these are important and <strong>should be segmented</strong></li>
        </ul>

        <h4>Dust, Defects & Fat Globules</h4>
        <ul class="checklist">
            <li>If dust/defects are (nearly) <strong>fully contained within a single cell</strong>, then <strong>color over them</strong></li>
            <li>If dust/defects <strong>span multiple cells</strong> and are <strong>small enough</strong> that it's easy to <strong>draw an imaginary boundary between</strong> the involved cells, then do so</li>
            <li>If they are <strong>large enough</strong> that drawing an imaginary boundary is not easy, create a separate <strong>"defect mask"</strong> that can safely cover the dust or defects</li>
            <li>For <strong>fat globules</strong> (or ER-membrane swirling), color them separately and as accurately as possible</li>
        </ul>

        <h4>Myelin & Special Structures</h4>
        <ul class="checklist">
            <li><strong>Myelin</strong> should be its <strong>own segment</strong></li>
            <li>Always <strong>check with the project leader when you have questions</strong> and keep a collection of images to help illustrate tough areas you want clarification for</li>
            <li>Be mindful that <strong>these rules change</strong> - it's always a good idea to ask for help if you aren't sure about something</li>
        </ul>
    </div>

    <div id="gt-verification-detail">
        <h3>Task Verification Procedures <span class="badge badge-current">Current</span></h3>
        <p><em>How to verify ground truth tasks - Seung Lab</em></p>

        <h4>Cell Segmentation - VAST Inspection</h4>
        <ol>
            <li><strong>Check borders:</strong> Spend a few minutes cycling up and down through the stack to get a sense of how accurate the coloring is close to the borders. If there's significant bleeding (coloring over the border) or undercoloring (not coloring all the way to the border), make a note of the affected segments.</li>
            <li><strong>Check for mergers & splits:</strong> Inspect each segment one-by-one: select a segment, then scroll through the relevant portion of the stack. If a segment is improperly joined with another segment, make a note. If a segment is not properly merged with another segment, make a note.</li>
            <li><strong>Check for missing segments:</strong> Cycle through the entire stack paying careful attention to areas without any segments. If there's a segment that was missed, make a note of it.</li>
            <li><strong>Decide whether to verify:</strong>
                <ul>
                    <li>If there are no border issues, no mergers or splits, and no missed segments - verify the task. Let the original annotator know they did a good job.</li>
                    <li>If there are issues - do not verify the task. Let the original annotator know where they need to make corrections.</li>
                </ul>
            </li>
        </ol>

        <div class="alert alert-info">
            <strong>Note:</strong> Experts don't necessarily need to correct their own mistakes - they just need to see them.
        </div>

        <h4>Cell Segmentation - Omni Inspection</h4>
        <p>Cycle through all segments and inspect that for each:</p>
        <ul class="checklist">
            <li>Check that it doesn't contain a merge error</li>
            <li>Check that it's not part of a split error</li>
            <li>Check that there's no undercoloring</li>
            <li>Check that there's no overcoloring</li>
            <li>Check that there's no hanging pixels that weren't erased completely</li>
            <li>Check that well-identified neighboring segments aren't totally skipped</li>
        </ul>

        <h4>Other Task Types (To Be Documented)</h4>
        <ul>
            <li>Synapse labeling</li>
            <li>Mitochondria labeling</li>
            <li>Semantic segmentation</li>
            <li>Vesicle cloud labeling</li>
            <li>Myelin labeling</li>
        </ul>

        <h4>Appeal Process</h4>
        <p>If you disagree with verification feedback, acquire assistance from a Verified Researcher for a second opinion.</p>
    </div>
</section>

<!-- Training Section -->
<section id="training">
    <h2>Training Materials</h2>

    <div id="synapses">
        <h3>Synapse Annotation <span class="badge badge-training">Training</span></h3>

        <p>Synapses are identified by vesicle clouds and synaptic clefts. Key structures:</p>

        <h4>Presynaptic Side (Axon)</h4>
        <ul>
            <li>Contains vesicle clouds (clusters of small dark circles)</li>
            <li>T-bar structures (fly synapses)</li>
            <li>Active zone at membrane</li>
        </ul>

        <h4>Postsynaptic Side (Dendrite)</h4>
        <ul>
            <li>Postsynaptic density (PSD) - dark line along membrane</li>
            <li>Spine or trunk structure</li>
        </ul>

        <h4>Neuroglancer Synapse Workflow</h4>
        <p><em>Step-by-step guide for synapse annotation in Neuroglancer</em></p>

        <table>
            <tr><th>Action</th><th>Control</th><th>Description</th></tr>
            <tr><td>Focus view on point</td><td>Right Click</td><td>Centers the view on clicked location</td></tr>
            <tr><td>Rotate/Move view</td><td>Left Click</td><td>Rotates in 3D, drag and move in 2D</td></tr>
            <tr><td>Zoom</td><td><kbd>Ctrl</kbd>+Scroll</td><td>Zoom in/out</td></tr>
            <tr><td>Place/Erase Synapse</td><td>Hold <kbd>Ctrl</kbd>+Left Click</td><td>Place or remove synapse points</td></tr>
            <tr><td>Highlight Segment</td><td>Double Left Click</td><td>Highlight the selected segment</td></tr>
            <tr><td>Toggle Alpha</td><td><kbd>2</kbd></td><td>Toggle transparency</td></tr>
            <tr><td>Scroll EM slides</td><td>Scroll Wheel</td><td>Navigate through slices</td></tr>
            <tr><td>Step through slides</td><td><kbd>.</kbd> and <kbd>,</kbd></td><td>Individual slice navigation</td></tr>
        </table>

        <h4>Annotation Procedure</h4>
        <ol>
            <li><strong>Inspect AI annotations first:</strong> Review each synapse the AI identified to make sure they were properly labeled and points are well placed</li>
            <li><strong>Always annotate Axon first:</strong> Red point places first (presynaptic), blue point second (postsynaptic). <span style="color: #e74c3c;">Axon = Red</span>, <span style="color: #3498db;">Dendrite = Blue</span></li>
            <li><strong>Navigate to synapses:</strong> Use the "Synapses" dropdown menu at the top to quickly jump to each annotation, or right-click on them in 2D or 3D</li>
            <li><strong>For Axons:</strong> Look at the 3D mesh and focus on any boutons - boutons may have more than one synapse</li>
            <li><strong>For Dendrites:</strong> First look through all visible spine heads in the 3D mesh, then scroll through the 2D EM stack to find any synapses along the trunk the AI might have missed</li>
            <li><strong>Save your work:</strong> Hit "Save edges" when confident all synapses are correct, then "Next Segment"</li>
            <li><strong>Non-neuronal structures:</strong> If you find glia, blood cells, or other non-neuronal structures, click "Delete All Points" from the Synapses menu, then save</li>
        </ol>

        <h4>Synapse Identification Tips</h4>
        <ul class="checklist">
            <li>Look for vesicle clouds first - they indicate presynaptic terminals</li>
            <li>Find the synaptic cleft (gap between cells)</li>
            <li>Identify the PSD on the postsynaptic side</li>
            <li>For fly synapses, look for T-bar structures</li>
            <li>Use 3D mesh to verify connectivity</li>
        </ul>

        <h4>The Four Synapse Indicators</h4>
        <p>Synapses have 4 indicators, one of which is <strong>mandatory</strong>:</p>
        <table>
            <tr><th>Indicator</th><th>Required?</th><th>Description</th></tr>
            <tr><td style="color: #e74c3c;"><strong>Dense cluster of vesicles</strong></td><td style="color: #e74c3c;"><strong>MANDATORY</strong></td><td>Primary indicator - must be present</td></tr>
            <tr><td>PSD (Postsynaptic Density)</td><td>2 of 3 needed</td><td>Dark line on dendrite side</td></tr>
            <tr><td>Synaptic cleft</td><td>2 of 3 needed</td><td>Gap between cells</td></tr>
            <tr><td>T-bar</td><td>2 of 3 needed</td><td>Structure in fly synapses</td></tr>
        </table>
        <div class="alert alert-warning">
            <strong>Rule:</strong> You need the primary indicator (vesicle cluster) + at least 2 of the 3 secondary indicators. Without these, do NOT annotate.
        </div>

        <h4>Synapse Types (Benjamin D. Silverman Classification)</h4>
        <details>
            <summary>Classic Synapse</summary>
            <div class="content">
                <p>Standard synapse structure with:</p>
                <ul>
                    <li><span style="color: #e74c3c;">Red</span> = PSD</li>
                    <li><span style="color: #3498db;">Dark Blue</span> = Spine head/dendrite</li>
                    <li><span style="color: #27ae60;">Green dots</span> = Vesicles</li>
                    <li><span style="color: #9b59b6;">Light Purple</span> = Axon</li>
                </ul>
            </div>
        </details>
        <details>
            <summary>Hand Type Synapse</summary>
            <div class="content">
                <p>Contiguous synapse where multiple PSDs share the same structure but are not continuous. <strong>All PSDs should be given the same segment ID</strong> if they connect to the same PSD within another slice.</p>
            </div>
        </details>
        <details>
            <summary>Little Straggler Synapse</summary>
            <div class="content">
                <p>No PSD visible due to how slices were cut. The PSD is not shown even though you can tell it's a synapse. <strong>Cannot label these</strong> - you'll encounter these often once you develop an eye for synapses.</p>
            </div>
        </details>
        <details>
            <summary>Pancake Synapse</summary>
            <div class="content">
                <p>Axon infiltrated by spine head - spine acts like a "hat" to the axon. PSD is squished and wider than normal. <strong>Annotate in a wide manner.</strong></p>
            </div>
        </details>
        <details>
            <summary>Slide Synapse</summary>
            <div class="content">
                <p>Axon synapsing with the shaft/trunk of a dendrite (not the spine). Even if PSD is split across slices, they are <strong>still one segment ID</strong>.</p>
            </div>
        </details>

        <h4>PSD vs Surfacing Neuron Shadow</h4>
        <p>PSDs and surfacing neuron shadows can look similar. Key differences:</p>
        <ul>
            <li>In a synapse, the darkened area is in the <strong>dendrite/postsynaptic body</strong>, not the axon</li>
            <li>Surfacing neurons lack the mandatory vesicle cluster indicator</li>
            <li>Check for synaptic cleft and T-bar to confirm</li>
        </ul>

        <h4>T-Bar Variations (Fly Synapses)</h4>
        <ul>
            <li><strong>Short T-Bars:</strong> Sometimes just dots</li>
            <li><strong>Long T-Bars:</strong> Can "travel" across slices</li>
            <li>Longer T-bars are easier to identify</li>
        </ul>

        <h4>Vesicle Types</h4>
        <ul>
            <li><strong>Dense vesicles:</strong> Loads of tightly packed vesicles</li>
            <li><strong>Sparse vesicles:</strong> Few vesicles (1-6) usually near boundaries - keep keen eye out for these!</li>
        </ul>

        <h4>PSD Tracing Guidance</h4>
        <p>When tracing a PSD, trace about <strong>halfway through to the boundary</strong>. Do not trace beyond the dark line cutting across like a "hamburger-style roll."</p>

        <div class="alert alert-info">
            <strong>Training images available:</strong> See <code>drive_docs_output/Ground-Truth-Training/synapse training videos/</code> for examples of t-bars and PSDs.
        </div>
    </div>

    <div id="vesicles">
        <h3>Vesicle Tracing <span class="badge badge-training">Training</span></h3>

        <h4>Vesicle Tracing Procedure</h4>
        <ol>
            <li><strong>Setup:</strong> Open VAST, the EM you want, and create a new segmentation</li>
            <li><strong>Enable tools:</strong> Set auto-fill (checkbox labeled "Fill") and conditional painting (both in right-side options)</li>
            <li><strong>Set range:</strong> Good range for conditional painting is <code>0.00 - 0.34</code></li>
            <li><strong>Find clouds:</strong> Look for vesicle clouds and find the associated synapse</li>
            <li><strong>Skip orphans:</strong> If a cloud has no synapse, there is no need to trace it</li>
            <li><strong>Trace completely:</strong> Trace the whole cloud as long as it's continuous</li>
            <li><strong>Watch boundaries:</strong> Be careful of boundaries and other organelles that might get caught in conditional tracing</li>
        </ol>

        <h4>Vesicle Reviewing Procedure</h4>
        <ol>
            <li>Open the corresponding synapse segmentation for your EM volume</li>
            <li>Check how many synapses have been traced vs how many vesicle clouds have been traced</li>
            <li>If either segmentation has fewer segments, try to locate where you missed one (cloud or cleft)</li>
        </ol>

        <div class="alert alert-info">
            <strong>Key insight:</strong> A good method to find synapses is to find an axon and look for its vesicles. Some axons have sparse vesicles and some have loads of dense vesicles. In sparse axons, keep a keen eye out for little clusters of 1-6 vesicles usually near its boundaries.
        </div>
    </div>

    <div id="semantic">
        <h3>Semantic Segmentation <span class="badge badge-training">Training</span></h3>

        <p>Semantic labeling assigns meaningful categories to segments. This procedure creates ground truth semantic segmentations for ML training.</p>

        <h4>Workflow</h4>
        <ol>
            <li>Create and open the project in Omni (refer to How To VAST document on creating an Omni file from a VAST file)</li>
            <li>Check the segment ID numbering - if IDs don't increment with size ordering, notify the project owner</li>
            <li>Once confirmed, create a Google Sheet named appropriately for the dataset</li>
            <li>In that sheet, list the classifiers for each segment ID</li>
            <li>Go through the segment list and determine the classification for each</li>
            <li>Record the classifier code for each segment</li>
        </ol>

        <h4>Standard Classification Codes</h4>
        <table>
            <tr><th>Code</th><th>Category</th><th>Description</th></tr>
            <tr><td><code>0</code></td><td>Undefined</td><td>Not yet classified</td></tr>
            <tr><td><code>1</code></td><td>Soma</td><td>Cell body</td></tr>
            <tr><td><code>2</code></td><td>Axon</td><td>Presynaptic neuronal process</td></tr>
            <tr><td><code>3</code></td><td>Dendrite</td><td>Postsynaptic neuronal process</td></tr>
            <tr><td><code>5</code></td><td>Glia</td><td>Glial cells (astrocytes, etc.)</td></tr>
            <tr><td><code>6</code></td><td>Unknown</td><td>Unable to classify with confidence</td></tr>
            <tr><td><code>7</code></td><td>Epithelial Cell</td><td>Glia surrounding blood vessel</td></tr>
            <tr><td><code>8</code></td><td>Blood Vessel</td><td>Vasculature</td></tr>
            <tr><td><code>9</code></td><td>Myelin Sheath</td><td>Cell membrane of myelinated axon</td></tr>
            <tr><td><code>99</code></td><td>Not Present</td><td>Segment not visible in volume</td></tr>
        </table>

        <div class="alert alert-info">
            <strong>Tip:</strong> A useful additional classifier would be dendritic spine head for more detailed analysis.
        </div>
    </div>
</section>

<!-- Setup Section -->
<section id="setup">
    <h2>Setup Guides</h2>

    <div class="card-grid">
        <div class="card">
            <h4>CAVE Authentication</h4>
            <p>Set up credentials for CAVE API access.</p>
            <pre><code>mkdir -p ~/.cloudvolume/secrets
# Add cave-secret.json</code></pre>
        </div>

        <div class="card">
            <h4>Tampermonkey Installation</h4>
            <p>Install browser extension and import userscripts (~2 min).</p>
            <ol style="font-size: 0.9em; margin-top: 10px;">
                <li><strong>Install:</strong> <a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo">Chrome</a> | <a href="https://addons.mozilla.org/firefox/addon/tampermonkey/">Firefox</a> | <a href="https://microsoftedge.microsoft.com/addons/detail/tampermonkey/iikmkjmpaadaobahmlepeloendndfphd">Edge</a></li>
                <li><strong>Dashboard:</strong> Click Tampermonkey icon â†’ Dashboard</li>
                <li><strong>Drag & Drop:</strong> Drag .user.js file onto Dashboard</li>
                <li><strong>Install:</strong> Click "Install" on the script page</li>
                <li><strong>Verify:</strong> Refresh WebKnossos, check Tampermonkey icon shows "1"</li>
            </ol>
            <p style="font-size: 0.85em; margin-top: 8px;"><strong>Brave users:</strong> Enable Developer Mode AND "Allow User Scripts" in extension settings.</p>
        </div>

        <div class="card">
            <h4>tracer_tools Setup</h4>
            <p>Python library installation.</p>
            <pre><code>pip install -e .
pip install caveclient</code></pre>
        </div>

        <div class="card">
            <h4>Google Sheets Integration</h4>
            <p>OAuth setup for Sheets API.</p>
            <p style="font-size: 0.9em;">See <code>tracer_tools/GOOGLE_SHEETS_SETUP.md</code></p>
        </div>
    </div>
</section>

<!-- History Section -->
<section id="history">
    <h2>Historical Tools & Documentation</h2>

    <div class="alert alert-warning">
        <strong>Legacy Reference:</strong> These tools are no longer in primary use but documentation is preserved for reference and for understanding historical data.
    </div>

    <div id="vast-docs">
        <h3>VAST <span class="badge badge-deprecated">Deprecated</span></h3>
        <p>Volume Annotation Software Tool - earlier annotation tool used for vesicle tracing and segmentation.</p>

        <details>
            <summary>VAST Checklist</summary>
            <div class="content">
                <ol>
                    <li>Save EM VAST file in root directory as <code>[root folder name].vsv</code> (e.g., Vol001_Raw.vsv)</li>
                    <li>Save VAST annotation file as <code>[rootfoldername]_[annotation task type].vsseg</code></li>
                    <li>Save your work as you go along</li>
                    <li>Have your annotation reviewed (see verification policy)</li>
                    <li>Export with properties: .TIF (uncomp.), 24bit/px RGB-encoded, check "collapse labels as in current view"</li>
                    <li>Save images in directory named for annotation task type</li>
                    <li>Notify project owner that annotation has been exported</li>
                    <li>If cell segmentation, have project reviewed in Omni</li>
                    <li>Correct any errors reviewer catches</li>
                    <li>Re-export & re-omnify if necessary</li>
                </ol>
            </div>
        </details>

        <details>
            <summary>VAST Workflow</summary>
            <div class="content">
                <h4>Import EM Images</h4>
                <ol>
                    <li>Go to File â†’ Import EM Stack From Images</li>
                    <li>Navigate to project folder and enter the Raw folder</li>
                    <li>Select all .TIF images and hit Open</li>
                    <li>Hit OK to the pop-up windows</li>
                    <li>Save the EM file in the Raw folder with root folder name</li>
                </ol>

                <h4>Begin Segmentation</h4>
                <p>With fresh EM imported, hit the pencil button under File dropdown. Hit OK. Begin painting.</p>

                <h4>Welding and Collapsing Labels</h4>
                <p>To combine segments with different IDs: Drag segment 6 and drop it into segment 112 (or vice versa). This creates a segment sub-tree. Right-click parent segment â†’ "weld segment sub tree" OR weld at export phase.</p>

                <h4>Exporting</h4>
                <ol>
                    <li>Go to File â†’ Export</li>
                    <li>Select .TIF (uncomp.) and 24bit/px RGB-encoded</li>
                    <li>Check "collapse labels as in current view"</li>
                    <li>Browse to the Segmentation folder and save</li>
                </ol>
            </div>
        </details>

        <details>
            <summary>VAST Synapse Annotation & Review</summary>
            <div class="content">
                <h4>Annotation</h4>
                <ol>
                    <li>Begin new VAST project in desired dataset</li>
                    <li>Click pencil icon to spawn 16 new segments</li>
                    <li>Name segments for: cleft, axon/presynaptic site, dendrite/postsynaptic site, uncertain clefts</li>
                    <li>Trace all synaptic clefts, denoting pre/postsynaptic sites</li>
                </ol>

                <h4>Review</h4>
                <ol>
                    <li>Open VAST project to review</li>
                    <li>Check segment by segment</li>
                    <li>Look for missed synapses using alpha adjustment</li>
                    <li>Cross-reference with vesicle cloud annotations if available</li>
                </ol>
            </div>
        </details>
    </div>

    <div id="omni-docs">
        <h3>Omni <span class="badge badge-deprecated">Deprecated</span></h3>
        <p>Desktop annotation and proofreading software for 3D neuron reconstruction.</p>

        <details>
            <summary>Omni Quick Start</summary>
            <div class="content">
                <ol>
                    <li>Click the <strong>cursor</strong> button</li>
                    <li>Click either "two rectangles" (2D+3D) or "multicolored square" (all views)</li>
                    <li>Left-click <strong>segmentation1</strong> in the left panel</li>
                    <li>Set <strong>Global Threshold</strong> (0.750-0.600 typical)</li>
                    <li>Set <strong>Auto Spread Threshold</strong> (0.350-0.500 typical)</li>
                    <li>Begin construction, joining, and validation of segments</li>
                </ol>

                <h4>Tracing Workflow</h4>
                <ol>
                    <li>Left-click segment with largest Total Size in Working Tab</li>
                    <li>Press <kbd>C</kbd> to center on selected segment</li>
                    <li>Look for missing branches, pieces, spines, nubs, dust, mergers</li>
                    <li>Press <kbd>J</kbd> to Join All</li>
                    <li>Press <kbd>V</kbd> to Validate and move to Valid Tab</li>
                </ol>
            </div>
        </details>

        <details>
            <summary>Omni Key Controls</summary>
            <div class="content">
                <table>
                    <tr><th>Action</th><th>Control</th></tr>
                    <tr><td>Center on segment</td><td><kbd>C</kbd></td></tr>
                    <tr><td>Join All</td><td><kbd>J</kbd></td></tr>
                    <tr><td>Validate</td><td><kbd>V</kbd></td></tr>
                    <tr><td>Undo</td><td><kbd>Ctrl</kbd>+<kbd>Z</kbd></td></tr>
                    <tr><td>Deselect all except clicked</td><td><kbd>Ctrl</kbd>+Right-click</td></tr>
                    <tr><td>Deselect only clicked</td><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+Right-click</td></tr>
                </table>
            </div>
        </details>

        <details>
            <summary>Omni Troubleshooting</summary>
            <div class="content">
                <h4>Auto Save</h4>
                <p>Omni saves what you "Join" and "Split". <strong>Periodically Join All</strong> to protect against crashes.</p>

                <h4>Crashes & Freezes</h4>
                <ul>
                    <li>If Omni won't close conventionally, use <code>htop</code> command in terminal</li>
                    <li>Find Omni in process list (look for red numbers in VIRT column)</li>
                    <li>Press <kbd>F9</kbd> then Enter to kill</li>
                </ul>

                <h4>Common Issues</h4>
                <ul>
                    <li>If accidentally deselect everything: <kbd>Ctrl</kbd>+<kbd>Z</kbd> to undo</li>
                    <li>Sometimes freezes resolve by waiting 1-2 minutes</li>
                    <li>Moving/minimizing Omni window may unfreeze it</li>
                </ul>
            </div>
        </details>

        <details>
            <summary>Omni Glossary</summary>
            <div class="content">
                <table>
                    <tr><th>Term</th><th>Definition</th></tr>
                    <tr><td>Dust</td><td>Little voxel bits inside large dendrites/axons that aren't essential</td></tr>
                    <tr><td>Merger</td><td>AI mistake where it combined two non-connecting dendrites/axons</td></tr>
                    <tr><td>Segment</td><td>A collection of supervoxels</td></tr>
                    <tr><td>Supervoxel</td><td>Polyhedral part of 3D digital image, larger than normal voxel</td></tr>
                    <tr><td>Spine</td><td>Small membranous protrusion from dendrite that receives axon input</td></tr>
                    <tr><td>Unsplittable Merger</td><td>A merger that can't be corrected by a player</td></tr>
                </table>
            </div>
        </details>
    </div>

    <div id="eyewire-docs">
        <h3>Eyewire <span class="badge badge-deprecated">Deprecated</span></h3>
        <p>Citizen science neuron tracing platform - browser-based game for neuron reconstruction. Replaced by professional annotation tools.</p>
    </div>

    <div class="timeline" style="margin-top: 30px;">
        <h4>Tool Evolution Timeline</h4>
        <div class="timeline-item deprecated">
            <h4>Eyewire Era</h4>
            <p class="date">Citizen science approach</p>
            <p>Browser-based gamified neuron reconstruction for public participation.</p>
        </div>

        <div class="timeline-item deprecated">
            <h4>VAST + Omni Era</h4>
            <p class="date">Professional desktop tools</p>
            <p>VAST for annotation, Omni for 3D proofreading. Ubuntu-based workflow with mounted network storage.</p>
        </div>

        <div class="timeline-item">
            <h4>WebKnossos + Neuroglancer Era</h4>
            <p class="date">Current</p>
            <p>Web-based tools with collaborative features, AI assistance (SAM2), and CAVE integration.</p>
        </div>
    </div>
</section>

<!-- Reference Section -->
<section id="reference">
    <h2>Quick Reference</h2>

    <h3>Document Links</h3>
    <table>
        <tr><th>Document</th><th>Type</th><th>Status</th></tr>
        <tr>
            <td><a href="New Documentation Styles-Templates-Files/HTML Versions/tommy_macrina_FINAL.html">Tommy Macrina Protocol Reference</a></td>
            <td>Expert Guide</td>
            <td><span class="badge badge-current">Current</span></td>
        </tr>
        <tr>
            <td><a href="New Documentation Styles-Templates-Files/HTML Versions/Ground_Truth_Protocol_Clarifications_GDOC.html">GT Protocol Clarifications</a></td>
            <td>Protocol</td>
            <td><span class="badge badge-current">Current</span></td>
        </tr>
        <tr>
            <td><a href="drive_docs_output/Misc/Copy of Neuroglancer Synapses.html">Neuroglancer Synapses Guide</a></td>
            <td>User Guide</td>
            <td><span class="badge badge-current">Current</span></td>
        </tr>
        <tr>
            <td><a href="drive_docs_output/Misc/Copy of Protocols for naming files.html">File Naming Protocols</a></td>
            <td>Standards</td>
            <td><span class="badge badge-reference">Reference</span></td>
        </tr>
        <tr>
            <td><a href="drive_docs_output/Misc/Copy of Neuroglancer Link Ressurection.txt">Neuroglancer Link Recovery</a></td>
            <td>Troubleshooting</td>
            <td><span class="badge badge-reference">Reference</span></td>
        </tr>
    </table>

    <h3>Keyboard Shortcuts Summary</h3>
    <table>
        <tr><th>Platform</th><th>Shortcut</th><th>Action</th></tr>
        <tr><td>WebKnossos</td><td><kbd>.</kbd></td><td>Toggle view modes</td></tr>
        <tr><td>WebKnossos</td><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>O</kbd></td><td>Toggle volume opacity</td></tr>
        <tr><td>WebKnossos</td><td><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>E</kbd></td><td>Toggle EM opacity</td></tr>
        <tr><td>Neuroglancer</td><td><kbd>Ctrl</kbd>+Scroll</td><td>Zoom</td></tr>
        <tr><td>Neuroglancer</td><td>Left Click</td><td>Mark axon (red)</td></tr>
        <tr><td>Neuroglancer</td><td>Right Click</td><td>Mark dendrite (blue)</td></tr>
    </table>

    <h3>Communication Channels</h3>
    <ul>
        <li><strong>Primary:</strong> Slack (#putracers channel)</li>
        <li><strong>Secondary:</strong> Zoom (for team meetings and detailed discussions)</li>
    </ul>
</section>

</main>

<a href="#" id="back-to-top">&uarr;</a>

<script>
// Search functionality
document.getElementById('search').addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase();
    const sections = document.querySelectorAll('section');

    sections.forEach(section => {
        const text = section.textContent.toLowerCase();
        if (query === '' || text.includes(query)) {
            section.style.display = 'block';
        } else {
            section.style.display = 'none';
        }
    });
});

// Back to top button
window.addEventListener('scroll', function() {
    const btn = document.getElementById('back-to-top');
    if (window.pageYOffset > 300) {
        btn.classList.add('visible');
    } else {
        btn.classList.remove('visible');
    }
});

// Smooth scroll for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
});
</script>

</body>
</html>
